# Hospital-Management-App

A Flutter app for capturing prescriptions, extracting text using OCR (Google ML Kit), parsing prescription fields (patient name, age, medicines, etc.), and saving/retrieving records to/from Firebase (Firestore). This repository contains UI, services, and viewmodels for scanning, parsing, and storing prescription data.

**This README describes:**
- Project purpose and features
- How to set up the project (Flutter + Firebase)
- How the OCR → parsing → Firebase pipeline works, with code file references
- How to run the app locally (Windows / PowerShell)

---

**Quick Links**

- Entry point: `lib/main.dart`
- Firebase configuration: `lib/firebase_options.dart`
- OCR/Text recognition: `lib/service/text_recognition_service.dart`
- Prescription parser: `lib/service/prescription_parser_service.dart`
- Firebase wrapper/service: `lib/services/firebase_service.dart`
- Scanner UI: `lib/view/scan/direct_scanner.dart`
- Prescription UI: `lib/view/prescription/prescription_detail_screen.dart`
- ViewModel for scanned content: `lib/viewmodel/scanned_viewmodel.dart`
- Auth views: `lib/view/auth/*` (e.g. `forgot_password_screen.dart`, `login_page.dart`)

---

**Project Structure (important folders in `lib/`)**

- `lib/view/` — UI screens and pages (organized by feature: `scan/`, `prescription/`, `auth/`, `home/`, etc.)
- `lib/service/` — business services (OCR, parsing, EMR service)
- `lib/services/` — app-wide service(s) that interact with external backends (Firebase wrapper, auth, firestore)
- `lib/viewmodel/` — viewmodels that connect UI to service layer
- `lib/model/` — data models (e.g. `patient.dart`, `visit.dart`)
- `lib/widget/` — reusable widgets and UI pieces

---

Getting started (prerequisites)

1. Install Flutter (stable channel) and ensure `flutter` is in your PATH.
2. Install Dart tools and Android/iOS toolchains if you plan to run on device/emulator.
3. Install the FlutterFire CLI (optional but recommended for Firebase integration):

```powershell
dart pub global activate flutterfire_cli
```

4. Ensure `firebase_options.dart` is present in `lib/` (this file is usually generated by the FlutterFire CLI and is required by `Firebase.initializeApp(...)`). If it's missing, run `flutterfire configure` in the project root and follow prompts.

---

Setup: install dependencies and run

```powershell
flutter pub get
flutter run
```

If you want to target a specific device/emulator, first launch it (or use `flutter devices`) and then run `flutter run -d <deviceId>`.

---

Firebase configuration notes

- `lib/firebase_options.dart` contains the platform-specific Firebase options; it is typically generated by the FlutterFire CLI.
- Initialize Firebase at app start — see `lib/main.dart`:

```dart
WidgetsFlutterBinding.ensureInitialized();
await Firebase.initializeApp(
  options: DefaultFirebaseOptions.currentPlatform,
);
```

- Firestore collection used by the app (example): `extracted_texts` (see `lib/services/firebase_service.dart`). The service provides helper methods like `saveExtractedText(...)` and `getExtractedTexts()` to store and fetch parsed OCR results.

Security tip: configure Firestore rules to restrict access to authenticated users and follow the principle of least privilege.

---

OCR and Prescription Extraction Pipeline (theory + code locations)

This app converts an image of a prescription into structured data in several modular steps:

1) Capture the image (UI)

- Where: `lib/view/scan/direct_scanner.dart` and related `view/scan/*` screens.
- What: Image can be taken using the camera or selected from gallery. The image file path (e.g. `XFile.path` or `File(path)`) is passed to the OCR service.

Theory: A good photo—well lit, in-focus, without heavy tilt or occlusion—improves OCR accuracy. Consider pre-processing (crop, rotate, contrast) for better results.

2) OCR — text recognition

- Where: `lib/service/text_recognition_service.dart`
- Key function: `recognizeTextFromImage({required String imgPath})` which uses Google ML Kit's `TextRecognizer` to extract `recognizedText.text` from an `InputImage`.

Theory: OCR (Optical Character Recognition) analyzes image pixels and groups them into characters, words, and lines. ML Kit’s `TextRecognizer` provides high-level text blocks and returns a single `String` containing extracted text. OCR errors are common (misreads, extra characters), so parsing must be tolerant.

3) Parsing unstructured text into structured fields

- Where: `lib/service/prescription_parser_service.dart`
- Called by: `lib/service/text_recognition_service.dart`'s `recognizePrescriptionFromImage(...)`, which does OCR then calls `parsePrescriptionText(rawText)`.
- What: The parser splits the OCR result into lines and searches for keywords/patterns (e.g., `Name`, `Age`, `DOB`, `Rx`, drug names, dosages). It uses string matching and regular expressions to extract probable values.

Theory: OCR output is noisy and prescriptions vary widely in format. Common techniques used by parsers:
- Normalize text (lowercase, remove punctuation where appropriate).
- Split into lines and trim whitespace.
- Use keyword-based heuristics (e.g., lines starting with "Name:" or containing "age") and regex for numeric patterns (age, dose amounts).
- Use fuzzy matching / confidence thresholds to handle OCR misspellings (optional improvement).

4) Combine and return structured data

- Where: `lib/service/text_recognition_service.dart` — `recognizePrescriptionFromImage(...)` returns a `Map<String, dynamic>` containing parsed fields such as `patient_name`, `patient_age`, `medications`, etc.

5) Persisting parsed results to Firebase

- Where: `lib/services/firebase_service.dart` provides methods like `saveExtractedText(String text, String source)` and `getExtractedTexts()`.
- Called from ViewModel: `lib/viewmodel/scanned_viewmodel.dart` or UI code once parsing completes and user confirms the extracted fields.

Theory: Firestore stores documents in collections. Each parsed prescription can be stored as a document containing fields: `patient_name`, `age`, `raw_text`, `medications` (array), `timestamp`, and perhaps `image_url` if you upload the image to Firebase Storage.

Example saved document (JSON-like):

```json
{
  "patient_name": "John Doe",
  "patient_age": 42,
  "medications": [{"name":"Amoxicillin","dose":"500mg","frequency":"TDS"}],
  "raw_text": "(full OCR text)...",
  "source": "camera",
  "timestamp": "2025-11-30T..."
}
```

6) Display and edit parsed data in UI

- Where: `lib/view/prescription/prescription_detail_screen.dart` and `lib/view/prescription/prescription_details_screen.dart`.
- What: Show extracted fields, allow user verification and edits prior to saving to Firestore.

---

Where to look for authentication and Firebase helpers

- `lib/services/auth_service.dart` — authentication helpers (sign-in/up flows)
- `lib/services/firebase_service.dart` — Firestore wrapper
- `lib/view/auth/*` — authentication UI pages (login, signup, forgot password). For example, `lib/view/auth/forgot_password_screen.dart` sends OTPs to an endpoint in your code; check network endpoints and security.

---

Useful code snippets

- Calling OCR + parser and saving result (example usage):

```dart
final textService = TextRecognitionService();
final result = await textService.recognizePrescriptionFromImage(imgPath: imagePath);
// `result` is a Map<String, dynamic> with parsed fields

// Save to Firebase (via the app's FirebaseService)
await FirebaseService().saveExtractedText(result['raw_text'] ?? '', 'camera');
```

---

Notes, improvements and troubleshooting

- OCR accuracy: consider pre-processing images (deskew, grayscale, contrast). ML-based classifiers or fine-tuned OCR can improve results for prescriptions.
- Parsing robustness: add more regex patterns, fuzzy matching, and a small rules engine to handle varied prescription formats.
- Storage: consider storing the original image in Firebase Storage and saving the URL with the extracted document.
- Offline: implement a local cache for scanned items when network is unavailable, and sync later.

---

Contributing

1. Fork the repo and create a feature branch.
2. Make changes and open a pull request describing the change.

Please follow Dart/Flutter formatting and linting rules.

---

License

This repository currently has no explicit license file. Add `LICENSE` if you want to specify one.

---

Contact / Questions

Open an issue in the repository or reach out to the maintainer for help with Firebase setup or parser improvements.
